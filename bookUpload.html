<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Book-Report[]</title>
       <!-- bootstrap min.css-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

    <link rel="stylesheet" href="css/main.css"/>
    <!-- bootstrap script-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"
        integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>       
    <!-- firebase -->    
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    </head>
<body>
  <div class="wrap">
    <header class="header" id="header">
        <div class="navbar fixed-top">
          <div class="col col-auto">
            <ul class="nav">
              <li>
                <a href="#"> 
                    <img src="img/icon/hamburger-1.png" alt="메뉴">
                </a>
              </li>
              <li>
                <a href="index.html"> 
                    <img src="img/icon/home-6.png" alt="홈">
                </a>
              </li>
              <li>
                <a href="#"> 
                    <img src="img/icon/calendar-3.png" alt="캘린더">
                </a>
              </li>
            </ul>              
          </div>
          <div class="col-auto">
            <ul class="util clear">
              <li>
                <a href="login.html"> 
                    <img src="img/icon/user.png" alt="마이페이지">
                </a>
              </li>
              <li>
                <a href="#"> 
                    <img src="img/icon/settings-2.png" alt="설정">
                </a>
              </li>
            </ul>
          </div>
        </div> 
      </header>
      <div class="bg_header"></div>
      <!-- //header -->





    <nav class="common-navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">Book-report</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="bookShelf.html">책장</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link active" aria-current="page" href="bookList.html">책목록</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link active" aria-current="page" href="bookInfo.html">책정보</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link active" aria-current="page" href="bookUpload.html">책올리기</a>
                  </li>
                
                  <li class="nav-item">
                      <a class="nav-link active" aria-current="page" href="bookModify.html">수정하기</a>
                  </li>
                
                  <li class="nav-item">
                      <a class="nav-link" href="Login.html">마이페이지</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="JoinUs.html">회원가입</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="intro.html">intro</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link disabled" aria-disabled="true">Disabled</a>
                  </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- //navBar -->
   


    <div class="container upload-container">
    <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
        <ol class="breadcrumb mt-4">
          <li class="breadcrumb-item home-btn"><a href="index.html"><img src="img/icon/home-6.png" alt=""></a></li>
          <li class="breadcrumb-item active bookUpload-btn" aria-current="page"><img src="img/icon/upload-2.png" alt="북 info"> book-Upload</li>
        </ol>
      </nav>

        <div class="logo-area">
          <h1 class="logo"><a href="index.html"><img src="img/icon/logo-Brown_sd.png" alt="로고"></a></h1>
        </div>
   

    <div class="container mt-3">
        <input type="text" class="form-control mt-2" id="title" placeholder="책제목" onfocus="this.placeholder=''" onblur="this.placeholder='책제목'">
        <input type="text" class="form-control mt-2" id="author" placeholder="저자" onfocus="this.placeholder=''" onblur="this.placeholder='저자'">
        <input type="text" class="form-control mt-2" id="publisher" placeholder="출판사" onfocus="this.placeholder=''" onblur="this.placeholder='출판사'">
        <form class="reading-date mt-3 mb-3" id="date">
            읽은날짜<br>
            <input type="datetime-local" value="2019-09-22" min="2019-09-10" max="2019-09-25"name="reservation" class="readingStart mt-2 mb-3"> - <input type="datetime-local"  value="2019-09-22" min="2019-09-10" max="2019-09-25" name="reservation" class="readingFinish">
        </form>
        <div class="row-cols">
            <div class="col-4 mb-2">
              <label class="visually-hidden" for="autoSizingSelect">Preference</label>
              <select class="form-select" id="autoSizingSelect">
                <option selected>내생각</option>
                <option value="1">내용요약</option>
                <option value="2">책속문장</option>
                <option value="3">의문점</option>
                <option value="4">알게된점</option>
              </select>
            </div>
            <div class="mb-3">                  
                <textarea class="form-control" id="exampleFormControlTextarea1" rows="12"></textarea>
            </div>
        </div>
        <input type="file" class="form-control mt-2" id="image">
        <button class="upload-btn btn btn-danger mt-3 mb-3" id="send">상품 올리기</button>
    </div>
  </div>
</div> 
    

    <script src="js/setting.js"></script>
    <script>
        //database 연결
        const db = firebase.firestore(); //텍스트 중심의 데이터 저장소
        const storage = firebase.storage(); //이미지나 오디오 저장소

        //content 입력영역에 포커스가 들어가면 비워줌
        $('#content').on('focus',() => {
            $('#content').val('')
        });

        //상품정보 업로드
        $('#send').on('click', (e)=>{ 
            e.preventDefault();

            //이미지 업로드할 때 반드시 명시하는 변수

            let file=document.querySelector('#image').files[0];
            let storageRef = storage.ref();
            let storageURL = storageRef.child('image/' + file.name) //이미지를 저장할 폴더지정
            let storageUpload = storageURL.put(file)            

            storageUpload.on('state_changed', 
                //변화시 동작 - 업로드 중
                null,
                //에러시 동작
                (error) => {
                    console.log('실패사유는', error)
                },
                //이미지 업로드 성공완료시
                () => {
                    storageUpload.snapshot.ref.getDownloadURL().then((url)=>{
                        //console.log('업로드된 경로는', url)

                        let uploadProduct = {
                            책제목 : $('#title').val(),
                            저자 : $('#author').val(),
                            출판사 : $('#publisher').val(), //가격정보가 문자열이 되도록 숫자형 데이터 타입으로 변환
                          /*   이미지: url, */
                            /* uid: JSON.parse(localStorage.getItem('user')).uid, */
                            이미지: url,
                           /*  올린이: JSON.parse(localStorage.getItem('user')).displayName */
                        }
                        console.log(uploadProduct.책제목)
                        //에러체크
                        db.collection('display').add(uploadProduct).then((result)=> {
                            //성공 후
                            console.log(result.id);   
                            confirm("업로드가 완료되었습니다. 메인페이지로 이동합니다.")
                            window.location.href='index.html'                         
                        }).catch((err) => {
                            console.log(err)
                        })

                    })
                }
            );
        })
    </script>
</body>
</html>